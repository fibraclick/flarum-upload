module.exports=function(t){var r={};function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=t,o.c=r,o.d=function(t,r,e){o.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:e})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,r){if(1&r&&(t=o(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(o.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var n in t)o.d(e,n,function(r){return t[r]}.bind(null,n));return e},o.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(r,"a",r),r},o.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},o.p="",o(o.s=10)}([function(t,r){t.exports=flarum.core.compat["forum/app"]},function(t,r){t.exports=flarum.core.compat["common/extend"]},function(t,r){t.exports=flarum.core.compat["common/components/TextEditor"]},,function(t,r){t.exports=flarum.core.compat["common/Component"]},function(t,r){t.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(t,r){t.exports=flarum.core.compat["common/components/Button"]},function(t,r){t.exports=flarum.core.compat["common/utils/classList"]},function(t,r){t.exports=flarum.core.compat["forum/components/DiscussionPage"]},function(t,r){t.exports=flarum.core.compat["common/components/Tooltip"]},function(t,r,o){"use strict";o.r(r);var e=o(0),n=o.n(e),i=o(1),a=o(2),s=o.n(a);function c(t,r){return(c=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(t,r)}var u=o(4),p=o.n(u),l=o(5),f=o.n(l),d=o(6),h=o.n(d),b=o(7),g=o.n(b),v=o(8),y=o.n(v),x=o(9),k=o.n(x),L=function(t){var r,o;function e(){return t.apply(this,arguments)||this}o=t,(r=e).prototype=Object.create(o.prototype),r.prototype.constructor=r,c(r,o);var i=e.prototype;return i.oninit=function(r){t.prototype.oninit.call(this,r),this.isLoading=!1,this.isSuccess=!1,this.isPasteListenerAttached=!1},i.oncreate=function(r){t.prototype.oncreate.call(this,r)},i.onupdate=function(r){t.prototype.onupdate.call(this,r),this.isPasteListenerAttached||(this.isPasteListenerAttached=!0,this.attrs.textArea.addEventListener("paste",this.paste.bind(this)))},i.view=function(){var t;this.isSuccess?t="fas fa-check green":this.isError?t="fas fa-times red":this.isLoading||(t="far fa-image");var r="";return this.isLoading?r=n.a.translator.trans("fibraclick-upload.forum.loading"):this.isSuccess&&(r=n.a.translator.trans("fibraclick-upload.forum.done")),m(k.a,{text:n.a.translator.trans("fibraclick-upload.forum.upload")},m(h.a,{className:g()(["Button","hasIcon","fibraclick-upload-button",""===r&&"Button--icon"]),icon:t,onclick:this.buttonClicked.bind(this)},this.isLoading&&m(f.a,{size:"small",display:"inline"}),m("span",{className:"Button-label"},r),m("form",null,m("input",{type:"file",accept:"image/*",onchange:this.formUpload.bind(this),disabled:this.isLoading||this.isSuccess||this.isError}))))},i.paste=function(t){if(!this.isLoading&&t.clipboardData)for(var r=0;r<t.clipboardData.items.length;r++){var o=t.clipboardData.items[r];if(o.type.startsWith("image")){var e=o.getAsFile();return void this.upload(e)}}},i.buttonClicked=function(t){this.$("input").trigger("click")},i.formUpload=function(t){var r=this.$("input").prop("files");0!==r.length&&this.upload(r[0])},i.upload=function(t){var r=this;this.isLoading=!0,m.redraw();var o=0;n.a.current.matches(y.a)&&(o=n.a.current.data.discussion.id());var e=new FormData;e.append("image",t),e.append("d",o),n.a.request({method:"POST",url:n.a.forum.attribute("apiUrl")+"/uploads",serialize:function(t){return t},body:e,errorHandler:function(t){return r.error(t)}}).then(this.success.bind(this))},i.success=function(t){var r=this;this.$("input").val(""),this.isLoading=!1,this.isSuccess=!0,m.redraw();var o="[IMMAGINE]"+t.fileName+"[/IMMAGINE]";0===this.attrs.editor.getSelectionRange()[0]?o+="\n\n":o="\n\n"+o+"\n\n",this.attrs.editor.insertAtCursor(o),setTimeout((function(){r.isSuccess=!1,m.redraw()}),2e3)},i.error=function(t){console.error(t),this.$("input").val(""),this.isLoading=!1,m.redraw(),n.a.alerts.show({type:"error"},this.errorToMessage(t))},i.errorToMessage=function(t){var r;return r=415===t.status?"fibraclick-upload.forum.error.unsupported":400===t.status||413===t.status?"fibraclick-upload.forum.error.too-big":"core.lib.error.generic_message",n.a.translator.trans(r)},e}(p.a);n.a.initializers.add("fibraclick-upload",(function(){Object(i.extend)(s.a.prototype,"controlItems",(function(t){t.add("imgur-upload",m(L,{textArea:this.$().parents(".Composer")[0],editor:this.attrs.composer.editor}))})),Object(i.extend)(s.a.prototype,"toolbarItems",(function(t){if(t.items.markdown){var r=t.items.markdown.content.children.findIndex((function(t){return"fas fa-image"==t.attrs.icon}));t.items.markdown.content.children.splice(r,1)}}))}))}]);
//# sourceMappingURL=forum.js.map